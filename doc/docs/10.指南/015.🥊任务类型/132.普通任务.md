---
title: ğŸ…æ™®é€šä»»åŠ¡
date: 2020-05-11 13:54:56 
permalink: /pages/2f844fmn
article: false
---

## å¦‚ä½•å¼€å‘ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡

::: warning å°æç¤º
çœ‹åˆ°è¿™é‡Œï¼Œå°ä¼™ä¼´ä»¬æ˜¯ä¸æ˜¯å·²ç»è¿«ä¸åŠå¾…çš„æƒ³çœŸæ­£çš„ä½“éªŒä¸€ä¸‹ <code>**Gobrs-Async**</code> æ˜¯æ€æ ·å¼€å‘ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„ã€‚ é‚£ä¹ˆä¸‹é¢ç”±æˆ‘å¸¦é¢†å¤§å®¶æ¥æ„Ÿå—ä¸€ä¸‹ ä¸€ä¸ªå®Œæ•´çš„ 
<code>**AsyncTask**</code> éœ€è¦æ€ä¹ˆå¼€å‘ã€‚
:::

## æ™®é€šä»»åŠ¡
*  åˆ›å»º Bean ç»§æ‰¿ AsyncTask
*  æ ‡è®° @Task æ³¨è§£


### ä»»åŠ¡æ ‡è¯†
å¦‚æœä½ æƒ³å¯¹ ä»»åŠ¡è¿›è¡Œå…¨å±€æ‹¦æˆª æ­¤æ—¶å°±éœ€è¦å¯¹æ¯ä¸€ä¸ªä»»åŠ¡åŠ ä¸€ä¸ªç‰¹æ®Šçš„æ ‡è¯†ï¼Œè¿™æ ·åœ¨åšå…¨å±€æ‹¦æˆªçš„æ—¶å€™ï¼Œå°±å¯ä»¥åŒºåˆ†ä¸åŒçš„ä»»åŠ¡ï¼Œä»è€Œæ‰§è¡Œä¸åŒçš„é€»è¾‘ã€‚æˆ–è€…è¿›è¡Œä¸åŒçš„æ—¥å¿—æ‰“å°
MQã€é“¾è·¯ç›‘æ§ç­‰ç­‰ã€‚ é‚£ä¹ˆ **Gobrs-Async** ä¸ºä½ æä¾›äº†æ”¯æŒã€‚ åªéœ€è¦åœ¨ ä»»åŠ¡ <code>Bean</code> ä¸­åŠ ä¸Šæ³¨è§£ï¼Œ åˆ™ä¼šå‘ŠçŸ¥æ¡†æ¶æ­¤ ä»»åŠ¡çš„åç§°
å³ [å…¨å±€ä»»åŠ¡æ‹¦æˆª](/pages/2f84sf/#å¯é…ç½®çš„å…¨å±€ä»»åŠ¡æ‹¦æˆªå™¨) ï¼Œå…¶ä¸­ æ³¨è§£ä¸­çš„ name å€¼å¯¹åº”çš„å°±æ˜¯å…¨å±€æ‹¦æˆªå™¨ä¸­å‚æ•°ä¸­çš„ <code>taskName</code>

```java 
@Task(name = "itemTask")
```

> è¿™é‡Œ AsyncTask<T, V> æ˜¯ä¸€ä¸ªæ³›å‹æ¥å£

* T ä»£è¡¨ ä»»åŠ¡çš„å‚æ•°ç±»å‹
* V ä»£è¡¨ ä»»åŠ¡çš„è¿”å›ç±»å‹

å¦‚ä¸‹ï¼š

```java 
/**
 * @program: gobrs-async
 * @ClassName TaskBean
 * @description: å¼‚æ­¥ä»»åŠ¡ ä»»åŠ¡å‚æ•° Objectç±»å‹ ; ä»»åŠ¡è¿”å› Objectç±»å‹
 **/
@Task
public class BService extends AsyncTask<Object, Object> {

    @Override
    public void prepare(Object o) {
        // ä»»åŠ¡å¼€å§‹ä¹‹å‰çš„æ“ä½œ å³task ä¹‹å‰
    }

    @Override
    public Object task(Object o, TaskSupport support) {
        String result = getResult(support, AService.class);
        System.out.println("æ‹¿åˆ°çš„ç»“æœ" + result);
        System.out.println("æ‰§è¡ŒBService");
        return null;
    }

    // ä»€ä¹ˆæ¡ä»¶ä¸‹è§¦å‘ taskæ‰§è¡Œ
    @Override
    public boolean nessary(Object o, TaskSupport support) {
        return true;
    }

    // taskæ‰§è¡ŒæˆåŠŸå›è°ƒç”¨
    @Override
    public void onSuccess(TaskSupport support) {

    }
    
    // task æ‰§è¡Œå¤±è´¥ å›è°ƒ
    @Override
    public void onFail(TaskSupport support) {

    }
}

```
### æ ¸å¿ƒä»»åŠ¡æ‰§è¡Œ

æ ¸å¿ƒä»»åŠ¡ä¸ºä½¿ç”¨è€…æœ€ä¸ºå…³æ³¨çš„åŠŸèƒ½æ–¹æ³•ï¼Œéœ€è¦å¼€å‘RPCã€HTTPã€IO ç­‰æ¶ˆè€—ç³»ç»Ÿèµ„æºçš„ä¸šåŠ¡é€»è¾‘ã€‚
```java 
@Override
public Object task(Object o, TaskSupport support) {
    // todo ä¸šåŠ¡é€»è¾‘
    return null;
}
```


### è·å–ä¾èµ–çš„ä»»åŠ¡ç»“æœ
**Gobrs-Async** æä¾›äº† <code>getResult</code> æ–¹æ³•ï¼Œæ— éœ€ç”¨æˆ·å…³æ³¨å¦‚ä½•è·å–åˆ°çš„ä¾èµ–ç»“æœï¼Œåªéœ€è¦æŒ‰ç…§ä½¿ç”¨æ–¹å¼ä¾¿å¯è½»æ¾è·å–æ‰€éœ€ç»“æœå€¼
```java
@Override
public Object task(Object o, TaskSupport support) {
    // æ‹¿åˆ° AService (ä»»åŠ¡bean) è¿”å›çš„ç»“æœï¼Œ ç»“æœç±»å‹ä¸ºStringç±»å‹
    String result = getResult(support, AService.class, String.class);
    
    return null;
}
```
<code>getResult</code> æœ‰ä¸‰ä¸ªå‚æ•°
* TaskSupport ï¼š **Gobrs-Async** æ‰€éœ€è¦çš„æ ¸å¿ƒå‚æ•°ï¼Œé€šè¿‡ <code>task</code> æ–¹æ³•ä¸­çš„å‚æ•°é€ç©¿å³å¯
* Class: æ‰€ä¾èµ–çš„ Beançš„ Java ç±»å‹
* Class: è¿”å›ç»“æœçš„ç±»å‹ 


### ä»»åŠ¡æ˜¯å¦æ‰§è¡Œ

**Gobrs-Async**  ä¼šæ ¹æ® <code>nessary</code>  çš„è¿”å›ç»“æœï¼Œåˆ¤æ–­å½“å‰<code>task</code> æ˜¯å¦éœ€è¦æ‰§è¡Œ å¦‚æœè¿”å›<code>true</code> åˆ™éœ€è¦è¢«æ‰§è¡Œï¼Œå¦åˆ™è¿”ä¹‹ã€‚

ä¾‹å¦‚ï¼š å½“å‚æ•°ä¸º <code>cancel</code> æ—¶ï¼Œ ä»»åŠ¡ä¸æ‰§è¡Œã€‚

```java 
@Override
public boolean nessary(String params, TaskSupport support) {
     // å‡å¦‚å‚æ•°æ˜¯cancel åˆ™ä¸æ‰§è¡Œå½“å‰ä»»åŠ¡
    if("cancel".equals(params)){
        return false;
    }
    return true;
}
```

### ä»»åŠ¡æˆåŠŸå›è°ƒ

å¦‚æœä½ æƒ³åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆååšä¸€äº›é¢å¤–çš„æ“ä½œã€‚ä¾‹å¦‚æ‰“å°æ—¥å¿—ã€å‘é€é‚®ä»¶ã€å‘é€MQã€è®°å½•ä¿¡æ¯ç­‰ã€‚ **Gobrs-Async**  åŒæ ·ä¹Ÿä¸ºä½ è€ƒè™‘åˆ°äº†ã€‚é€šè¿‡å®ç° callback æ–¹æ³•ã€‚ä¼šè®©ä½ è½»æ¾çš„æ‹¿åˆ°
ä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚

```java 
@Override
public void onSuccess(TaskSupport support) {
    // todo ä»»åŠ¡æˆåŠŸé€»è¾‘
}
```

### ä»»åŠ¡å¤±è´¥å›è°ƒ
åœ¨ä»»åŠ¡å¼‚å¸¸æ—¶å‘é€å‘Šè­¦ä¿¡æ¯
```java
@Override
public void onFail(TaskSupport support) {
    // todo  ä»»åŠ¡æ‰§è¡Œå¤±è´¥å›è°ƒé€»è¾‘
}
```


