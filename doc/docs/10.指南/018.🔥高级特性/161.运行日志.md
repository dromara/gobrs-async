---
title: ğŸ§‹è¿è¡Œæ—¥å¿—
date: 2020-05-11 13:54:56
permalink: /pages/2f8fad2s
article: false
---

## è‡ªå®šä¹‰æ—¥å¿—traceId
ä½¿ç”¨ `log.error(getFormattedTraceId(), exception);` æ‰“å°çš„æ—¥å¿—ä¼šè‡ªåŠ¨å¸¦ä¸Š traceIdï¼Œ `getFormattedTraceId` æ˜¯ `AsyncTask` æä¾›çš„é€šç”¨æ–¹æ³•ã€‚

```java 
@Slf4j
@Task(failSubExec = true)
public class BService extends AsyncTask {

    int i = 10000;
    @Override
    public void prepare(Object o) {
        log.info(this.getName() + " ä½¿ç”¨çº¿ç¨‹---" + Thread.currentThread().getName());
    }

    @Override
    public Object task(Object o, TaskSupport support) {
        System.out.println("BService Begin");
        for (int i1 = 0; i1 < i; i1++) {
            i1 += i1;
        }
        try {
            System.out.println(1 / 0);
        } catch (Exception exception) {
            log.error(getFormattedTraceId(), exception);
        }

        System.out.println("BService Finish");
        return null;
    }
}

```

## å¼€å¯å…¨å±€æ—¥å¿—æ‰“å°
* `costLogabled`ï¼šæ‰“å°ä»»åŠ¡æµç¨‹çš„å…¨é“¾è·¯æ‰§è¡Œè¿‡ç¨‹
* `errLogabled`ï¼šå¼€å¯ä»»åŠ¡å¼‚å¸¸æ‰“å° é»˜è®¤true
```yaml
gobrs:
  async:
    config:
      rules:
        - name: "optionalRule"
          content: "caseOptionalTaskA->caseOptionalTaskB->caseOptionalTaskC,caseOptionalTaskD->caseOptionalTaskE->caseOptionalTaskF"
          task-interrupt: false # å±€éƒ¨å¼‚å¸¸æ˜¯å¦æ‰“æ–­ä¸»æµç¨‹ é»˜è®¤false
          transaction: false
          logConfig:
            costLogabled: true # å¼€å¯ä»»åŠ¡è€—æ—¶æ‰“å° logæ—¥å¿—çº§åˆ«éœ€è¦ä¸º error é»˜è®¤true
            errLogabled: true # å¼€å¯ä»»åŠ¡å¼‚å¸¸æ‰“å° é»˜è®¤true

```
## æ‰“å°æ•ˆæœ
```sh 
CaseOptionalTaskA ä»»åŠ¡æ‰§è¡Œ
CaseOptionalTaskA ä»»åŠ¡æ‰§è¡Œå®Œæˆ
2022-12-11 15:47:32.511  INFO 13458 --- [o-8888-exec-152] com.gobrs.async.core.task.AsyncTask      :  <11781331511388032> [caseOptionalTaskA] execution
CaseOptionalTaskB ä»»åŠ¡æ‰§è¡Œ
CaseOptionalTaskB ä»»åŠ¡æ‰§è¡Œå®Œæˆ
2022-12-11 15:47:32.613  INFO 13458 --- [o-8888-exec-152] com.gobrs.async.core.task.AsyncTask      :  <11781331511388032> [caseOptionalTaskB] execution
CaseOptionalTaskD ä»»åŠ¡æ‰§è¡Œ
CaseOptionalTaskDä»»åŠ¡æ‰§è¡Œå®Œæˆ
2022-12-11 15:47:32.718  INFO 13458 --- [o-8888-exec-152] com.gobrs.async.core.task.AsyncTask      :  <11781331511388032> [caseOptionalTaskD] execution
2022-12-11 15:47:32.718  INFO 13458 --- [o-8888-exec-152] com.gobrs.async.core.TaskLoader          : ã€ProcessTraceã€‘Total cost: 311ms | traceId = 11781331511388032 | ã€taskã€‘caseOptionalTaskA cost :102msã€stateã€‘ï¼šsuccess; ->ã€taskã€‘caseOptionalTaskB cost :102msã€stateã€‘ï¼šsuccess; ->ã€taskã€‘caseOptionalTaskD cost :105msã€stateã€‘ï¼šsuccess; 
cost 311

```

## ç¬¬ä¸‰æ–¹æ—¥å¿—æ¡†æ¶é›†æˆ
è¿™é‡Œé€‰æ‹©[Tlog](https://tlog.yomahub.com/) æ—¥å¿—æ¡†æ¶ï¼Œ ä½¿ç”¨æ–¹æ³•è¿™é‡Œå°±ä¸åšèµ˜è¿°äº†ã€‚æ„Ÿå…´è¶£çš„å°ä¼™ä¼´å¯ä»¥åˆ°å®˜ç½‘æŸ¥çœ‹

### é›†æˆä½¿ç”¨
```java 

/**
 * å¯åŠ¨ç±»
 */
@SpringBootApplication
/**
 * ä½¿ç”¨gobrs-async-test æ¨¡å—åˆ›å»ºçš„ä»»åŠ¡ ä¸ºäº†æ–¹ä¾¿ä¸é‡å¤åˆ›å»ºä»»åŠ¡äº†
 */
@ComponentScan(value = {"com.gobrs.async"})
public class GobrsAsyncExampleApplication {

    /**
     * Tlog æ—¥å¿—æ‰“å°æ¡†æ¶ å®˜ç½‘: https://tlog.yomahub.com/
     */
    static {
        AspectLogEnhance.enhance();
    }

    /**
     * The entry point of application.
     *
     * @param args the input arguments
     */
    public static void main(String[] args) {
        SpringApplication.run(GobrsAsyncExampleApplication.class, args);
    }
}
```

### æ›´å¤šç»†èŠ‚

é›†æˆæ–¹å¼è¯·å‚è€ƒæºç ç¤ºä¾‹é¡¹ç›® [gobrs-async-example](https://gitee.com/dromara/gobrs-async/tree/master/gobrs-async-example) æˆ–è€…ç›´æ¥ä¸‹è½½æºç æŸ¥çœ‹ã€‚
[æºç åœ°å€](https://gitee.com/dromara/gobrs-async)




