---
title: ğŸè‡ªå®šä¹‰çº¿ç¨‹æ± 
date: 2020-05-11 13:54:56
permalink: /pages/2f84s1
article: false
---

## è‡ªå®šä¹‰å›ºå®šçº¿ç¨‹æ± 

**Gobrs-Async** é»˜è®¤ä½¿ç”¨çš„æ˜¯ <code>Executors.newCachedThreadPool()</code> çš„çº¿ç¨‹æ± ï¼Œ å¦‚æœä½ æƒ³è‡ªå®šä¹‰çº¿ç¨‹æ± ã€‚æ»¡è¶³è‡ªå·±çš„çº¿ç¨‹æ± éœ€æ±‚ã€‚
åªéœ€è¦ <code>GobrsAsyncThreadPoolFactory</code> å¯¹è±¡ï¼Œå¦‚ä¸‹ï¼š

```java 
@Configuration
public class ThreadPoolConfig {

    @Autowired
    private GobrsAsyncThreadPoolFactory factory;
    
    @PostConstruct
    public void gobrsThreadPoolExecutor(){
        ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(300, 500, 30, TimeUnit.SECONDS,
                new LinkedBlockingQueue());
        factory.setThreadPoolExecutor(threadPoolExecutor);
    }

```

## å®æ—¶æ›´æ–°çº¿ç¨‹æ± 

å¼€å‘è€…å¯èƒ½æœ‰è¿™ç§è‹¦æ¼ï¼Œçº¿ç¨‹æ± åœ¨è¿è¡Œæ—¶æ˜¯åœ¨é¡¹ç›®åˆå§‹åŒ–çš„æ—¶å€™ä»<code>application.yml</code>ä¸­ åŠ è½½çš„ï¼Œ ä¸€æ—¦ç¨‹åºè¿è¡Œèµ·æ¥ä¹‹åï¼Œå°±æ— æ³•ä¿®æ”¹ä½¿ç”¨çš„çº¿ç¨‹æ± äº†ã€‚
å¦‚æœè‡ªå·±å…¬å¸æœ‰åˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå¯ä»¥å®æ—¶æ›´æ–°ç¨‹åºå†…å­˜çš„åº”ç”¨çš„è¯ï¼Œé‚£ä¹ˆ**gobrs**ä¹Ÿä¸ºä½ æä¾›äº†å…¥å£ã€‚

åœ¨æˆ‘ä»¬å…¬å¸æ˜¯æœ‰è‡ªå·±çš„çƒ­æ›´æ–°ç»„ä»¶çš„ï¼Œæ‰€æœ‰å¯ä»¥å¦‚ä¸‹ä½¿ç”¨ï¼š

### é…ç½®ä¸­å¿ƒçš„çº¿ç¨‹æ± é…ç½®

```json 
{
corePoolSize: 210,
maxPoolSize: 600,
keepAliveTime: 30,
capacity: 10000,
threadNamePrefix: "m-detail"
rejectedExecutionHandlerï¼š "CallerRunsPolicy"
}
```


```java 
@Slf4j
@Configuration
public class ThreadPoolConfig {

    @Autowired
    private GobrsAsyncThreadPoolFactory factory;

    @Resource
    private DUCCConfigService duccConfigService;

    @PostConstruct
    public void gobrsThreadPoolExecutor() {
        // ä»é…ç½®ä¸­å¿ƒæ‹¿åˆ° çº¿ç¨‹æ± é…ç½®è§„åˆ™ DuccConstant.GOBRS_ASYNC_THREAD_POOL ä¸ºçº¿ç¨‹æ± é…ç½®åœ¨é…ç½®ä¸­å¿ƒçš„key
        String config = duccConfigService.getString(DuccConstant.GOBRS_ASYNC_THREAD_POOL);
        ThreadPool threadPool = JSONObject.parseObject(config, ThreadPool.class);
         
        // é€šè¿‡gobrs-async æä¾›çš„æ„é€ å™¨è¿›è¡Œæ„é€ çº¿ç¨‹æ± 
        ThreadPoolExecutor executor = ThreadPoolBuilder.buildByThreadPool(threadPool);
        factory.setThreadPoolExecutor(executor);
        listenerDucc();
    }
    
    // ç›‘å¬é…ç½®ä¸­å¿ƒ çº¿ç¨‹æ± æ”¹åŠ¨
    private void listenerDucc() {
        duccConfigService.addListener(new DuccListener(DuccConstant.GOBRS_ASYNC_THREAD_POOL, property -> {
            log.warn("ç›‘å¬åˆ°DUCCé…ç½®GobrsAsync çº¿ç¨‹æ± é…ç½®å˜æ›´ï¼Œpropertyï¼š{}", JSON.toJSONString(property.getValue()));
            ThreadPool threadPool = JSONObject.parseObject(property.getValue().toString(), ThreadPool.class);
            ThreadPoolExecutor executor = ThreadPoolBuilder.buildByThreadPool(threadPool);
            factory.setThreadPoolExecutor(executor);
            // çº¿ç¨‹æ± æ›´æ–°æˆåŠŸ
            log.warn("GobrsAsync thread pool update success");
        }));
    }

}

```


::: cardList

```yaml
- name: æŠ€æœ¯å°å±‹
  desc: å¤§é“è‡³ç®€ï¼ŒçŸ¥æ˜“è¡Œéš¾
  avatar: https://cdn.jsdelivr.net/gh/xugaoyi/image_store/blog/20200122153807.jpg # å¯é€‰
  link: https://docs.sizegang.cn/ # å¯é€‰
  bgColor: '#CBEAFA' # å¯é€‰ï¼Œé»˜è®¤var(--bodyBg)ã€‚é¢œè‰²å€¼æœ‰#å·æ—¶è¯·æ·»åŠ å•å¼•å·
  textColor: '#6854A1' # å¯é€‰ï¼Œé»˜è®¤var(--textColor)
- name: æ¶æ„å¸ˆå¿…ç»ä¹‹è·¯
  desc: 'ç²¾å“å­¦ä¹ èµ„æº'
  avatar: https://cdn.jsdelivr.net/gh/xaoxuu/assets@master/avatar/avatar.png
  link: https://learn.sizegang.cn
  bgColor: '#718971'
  textColor: '#fff'
- name: å¹³å‡¡çš„ä½ æˆ‘
  desc: å¿«ä¹è´­ç‰©ï¼Œäº«å—ç”Ÿæ´»
  avatar: https://reinness.com/avatar.png
  link: https://m.jd.com
  bgColor: '#FCDBA0'
  textColor: '#A05F2C'
```
:::
